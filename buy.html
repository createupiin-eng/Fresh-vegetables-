<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fresh Dhaniya - Buy Now</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg1:#0f1226; --bg2:#1b1f3b; --accent:#00e38e; --accent2:#7cffb2; --text:#e8f5e9; --muted:#c8d9d2; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:'Poppins',sans-serif; background: linear-gradient(135deg, var(--bg1), var(--bg2)); color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px; }
    .card{ width:100%; max-width:520px; border-radius:20px; padding:24px; backdrop-filter: blur(16px); background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 10px 40px rgba(0,0,0,0.35); }
    .title{ font-size:1.6rem; margin-bottom:6px; }
    .price{ color:#bfead3; margin-bottom:18px; }
    label{ font-size:0.9rem; color:#cfead7; }
    input{ width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.08); color:var(--text); outline:none; transition: border-color .2s; }
    input:focus{ border-color: var(--accent); }
    .btn{ width:100%; padding:12px 16px; border:none; border-radius:12px; font-weight:700; background: linear-gradient(135deg, var(--accent), var(--accent2)); color:#062016; cursor:pointer; transition: transform .2s, box-shadow .2s; margin-top:12px; }
    .btn:hover{ transform: translateY(-2px); box-shadow:0 8px 24px rgba(0,227,142,0.35); }
    .note{ margin-top:10px; text-align:center; color:#bcd9cc; font-size:0.9rem; min-height:18px; }
    .popup{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.5); }
    .popup.active{ display:flex; }
    .pop-card{ width:90%; max-width:420px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.18); border-radius:16px; padding:20px; text-align:center; backdrop-filter: blur(12px); animation: pop .25s ease; }
    .pop-title{ font-weight:700; margin-bottom:10px; }
    .pop-btn{ border:none; border-radius:999px; padding:10px 16px; font-weight:700; background: linear-gradient(135deg, var(--accent), var(--accent2)); color:#062016; cursor:pointer; }
    @keyframes pop{ from{ transform: scale(0.96); opacity:0;} to{ transform: scale(1); opacity:1;} }
  </style>
</head>
<body>
  <div class="card">
    <div class="title">Fresh Dhaniya - Buy Now</div>
    <div class="price">Price: 10 Pudina</div>
    <div>
      <label>Pudina Number (Optional)</label>
      <input type="tel" id="pudina" placeholder="12 digits only">
    </div>
    <button class="btn" id="buy">Buy Now</button>
    <div class="note" id="note"></div>
  </div>
  <div class="popup" id="popup">
    <div class="pop-card">
      <div class="pop-title">Purchase Successful</div>
      <div class="pop-text">Enjoy your fresh Dhaniya.</div>
      <div style="margin-top:12px;">
        <button class="pop-btn" id="close">Close</button>
      </div>
    </div>
  </div>
  <script>
    const token = localStorage.getItem('token');
    if (!token) { window.location.href='index.html'; }
    const note = document.getElementById('note');
    const pudinaInput = document.getElementById('pudina');
    document.getElementById('buy').onclick = async ()=>{
      note.textContent = '';
      const val = pudinaInput.value.trim();
      if (val && !/^\d{12}$/.test(val)){ note.textContent = 'Enter exactly 12 digits'; return; }
      const res = await fetch('/api/buy', { method:'POST', headers:{ 'Content-Type':'application/json', Authorization:'Bearer '+token }, body: JSON.stringify({ pudinaNumber: val || undefined }) });
      const json = await res.json();
      if (!res.ok){ note.textContent = json.error || 'Purchase failed'; return; }
      document.getElementById('popup').classList.add('active');
    };
    document.getElementById('close').onclick = ()=>{ document.getElementById('popup').classList.remove('active'); };
  </script>
</body>
</html>
